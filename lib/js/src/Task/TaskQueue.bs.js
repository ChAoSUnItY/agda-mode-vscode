// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var $$Promise = require("reason-promise/lib/js/src/js/promise.js");
var Belt_List = require("bs-platform/lib/js/belt_List.js");
var Belt_Option = require("bs-platform/lib/js/belt_Option.js");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var Util$AgdaModeVscode = require("../Util/Util.bs.js");

function getNextTask(self) {
  var match = self.view;
  var match$1 = self.agda;
  var match$2 = self.main;
  if (match !== undefined) {
    if (match) {
      self.view = match[1];
      return Caml_option.some(match[0]);
    } else {
      return ;
    }
  } else if (match$1 !== undefined) {
    if (match$1) {
      self.agda = match$1[1];
      return Caml_option.some(match$1[0]);
    } else {
      return ;
    }
  } else if (match$2) {
    self.main = match$2[1];
    return Caml_option.some(match$2[0]);
  } else {
    return ;
  }
}

function make(execute) {
  return {
          main: /* [] */0,
          agda: undefined,
          view: undefined,
          execute: execute,
          busy: false,
          shouldDestroy: undefined
        };
}

function kickStart(self) {
  if (self.busy) {
    return ;
  }
  var task = getNextTask(self);
  if (task !== undefined) {
    self.busy = true;
    return $$Promise.get(Curry._3(self.execute, self, kickStart, Caml_option.valFromOption(task)), (function (keepRunning) {
                  self.busy = false;
                  if (keepRunning) {
                    return kickStart(self);
                  }
                  
                }));
  }
  var resolve = self.shouldDestroy;
  if (resolve !== undefined) {
    return Curry._1(resolve, undefined);
  }
  
}

function destroy(self) {
  if (!self.busy) {
    return $$Promise.resolved(undefined);
  }
  var match = $$Promise.pending(undefined);
  self.shouldDestroy = match[1];
  return match[0];
}

function forceDestroy(self) {
  self.main = /* [] */0;
  self.agda = undefined;
  self.view = undefined;
  return $$Promise.resolved(undefined);
}

function addTasksToMain(self, tasks) {
  self.main = Belt_List.concat(self.main, tasks);
  
}

function toString(taskToString, param) {
  var main = param.main;
  var agda = param.agda;
  var view = param.view;
  var main$1 = "Main " + Util$AgdaModeVscode.Pretty.list(Belt_List.map(main, taskToString));
  var agda$1 = agda !== undefined ? "Agda " + Util$AgdaModeVscode.Pretty.list(Belt_List.map(agda, taskToString)) : "";
  var view$1 = view !== undefined ? "View " + Util$AgdaModeVscode.Pretty.list(Belt_List.map(view, taskToString)) : "";
  return main$1 + ("\n" + (agda$1 + ("\n" + view$1)));
}

function agdaIsOccupied(self) {
  return Belt_Option.isSome(self.agda);
}

function acquireAgda(self) {
  var match = self.agda;
  if (match !== undefined) {
    console.log("[ panic ] The Agda task queue has already been acquired");
    return ;
  } else {
    self.agda = /* [] */0;
    return ;
  }
}

function releaseAgda(self) {
  var remainingTasks = self.agda;
  if (remainingTasks !== undefined) {
    self.main = Belt_List.concat(remainingTasks, self.main);
    self.agda = undefined;
    return ;
  }
  
}

function addTasksToAgda(self, tasks) {
  var agda = self.agda;
  if (agda !== undefined) {
    self.agda = Belt_List.concat(agda, tasks);
    return ;
  } else {
    console.log("[ panic ] Cannot add task to the Agda task queue before acquiring it");
    return ;
  }
}

function viewIsOccupied(self) {
  return Belt_Option.isSome(self.view);
}

function acquireView(self) {
  var match = self.view;
  if (match !== undefined) {
    console.log("[ panic ] The View task queue has already been acquired");
    return ;
  } else {
    self.view = /* [] */0;
    return ;
  }
}

function releaseView(self) {
  var remainingTasks = self.view;
  if (remainingTasks !== undefined) {
    self.main = Belt_List.concat(remainingTasks, self.main);
    self.view = undefined;
    return ;
  }
  
}

function addTasksToView(self, tasks) {
  var view = self.view;
  if (view !== undefined) {
    self.view = Belt_List.concat(view, tasks);
    return ;
  } else {
    console.log("[ panic ] Cannot add task to the View task queue before acquiring it");
    return ;
  }
}

exports.getNextTask = getNextTask;
exports.make = make;
exports.kickStart = kickStart;
exports.destroy = destroy;
exports.forceDestroy = forceDestroy;
exports.addTasksToMain = addTasksToMain;
exports.toString = toString;
exports.agdaIsOccupied = agdaIsOccupied;
exports.acquireAgda = acquireAgda;
exports.releaseAgda = releaseAgda;
exports.addTasksToAgda = addTasksToAgda;
exports.viewIsOccupied = viewIsOccupied;
exports.acquireView = acquireView;
exports.releaseView = releaseView;
exports.addTasksToView = addTasksToView;
/* Promise Not a pure module */
