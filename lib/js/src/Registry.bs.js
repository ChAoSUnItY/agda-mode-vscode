// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var Js_dict = require("bs-platform/lib/js/js_dict.js");
var $$Promise = require("reason-promise/lib/js/src/js/promise.js");
var Belt_Array = require("bs-platform/lib/js/belt_Array.js");
var Belt_Option = require("bs-platform/lib/js/belt_Option.js");
var Util$AgdaModeVscode = require("./Util/Util.bs.js");
var Dispatcher$AgdaModeVscode = require("./Task/Dispatcher.bs.js");

function Impl(Editor) {
  var Dispatcher = Dispatcher$AgdaModeVscode.Impl(Editor);
  var dict = { };
  var get = function (fileName) {
    return Js_dict.get(dict, fileName);
  };
  var getByEditor = function (editor) {
    return Belt_Option.flatMap(Curry._1(Editor.getFileName, Curry._1(Editor.getDocument, editor)), get);
  };
  var add = function (fileName, dispatcher) {
    var match = Js_dict.get(dict, fileName);
    if (match !== undefined) {
      return ;
    } else {
      dict[fileName] = dispatcher;
      return ;
    }
  };
  var rename = function (oldName, newName) {
    var delete_ = (function (dict, key) {delete dict[key]});
    return Belt_Option.forEach(Js_dict.get(dict, oldName), (function (dispatcher) {
                  console.log("[ states ][ rename ]", oldName, newName);
                  delete_(dict, oldName);
                  return add(newName, dispatcher);
                }));
  };
  var remove = function (fileName) {
    var delete_ = (function (dict, key) {delete dict[key]});
    return delete_(dict, fileName);
  };
  var destroy = function (fileName) {
    var dispatcher = Js_dict.get(dict, fileName);
    if (dispatcher !== undefined) {
      remove(fileName);
      return Curry._1(Dispatcher.destroy, dispatcher);
    } else {
      return $$Promise.resolved(undefined);
    }
  };
  var forceDestroy = function (fileName) {
    var dispatcher = Js_dict.get(dict, fileName);
    if (dispatcher !== undefined) {
      remove(fileName);
      return Curry._1(Dispatcher.forceDestroy, dispatcher);
    } else {
      return $$Promise.resolved(undefined);
    }
  };
  var contains = function (fileName) {
    return Belt_Option.isSome(Js_dict.get(dict, fileName));
  };
  var destroyAll = function (param) {
    return Util$AgdaModeVscode.oneByOne(Belt_Array.map(Js_dict.entries(dict), (function (param, param$1) {
                      return Curry._1(Dispatcher.destroy, param[1]);
                    })));
  };
  return {
          Dispatcher: Dispatcher,
          dict: dict,
          get: get,
          getByEditor: getByEditor,
          add: add,
          rename: rename,
          remove: remove,
          destroy: destroy,
          forceDestroy: forceDestroy,
          contains: contains,
          destroyAll: destroyAll
        };
}

exports.Impl = Impl;
/* Promise Not a pure module */
