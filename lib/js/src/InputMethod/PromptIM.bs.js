// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Buffer$AgdaModeVscode = require("./Buffer.bs.js");

function make(param) {
  return {
          activated: false,
          buffer: Buffer$AgdaModeVscode.make(undefined),
          textBeforeActivation: ""
        };
}

function activate(self, text) {
  self.activated = true;
  self.textBeforeActivation = text;
  
}

function deactivate(self) {
  self.activated = false;
  self.buffer = Buffer$AgdaModeVscode.make(undefined);
  self.textBeforeActivation = "";
  
}

function isActivated(self) {
  return self.activated;
}

function init(s) {
  return s.substring(0, s.length - 1 | 0);
}

function last(s) {
  return s.substring(s.length - 1 | 0);
}

function deviseChange(self, input) {
  var inputLength = input.length;
  var bufferSurface = Buffer$AgdaModeVscode.toSurface(self.buffer);
  if (init(input) === self.textBeforeActivation + bufferSurface) {
    return {
            offset: inputLength - 1 | 0,
            insertedText: last(input),
            replacedTextLength: 0
          };
  } else if (input === self.textBeforeActivation || input === self.textBeforeActivation + init(bufferSurface)) {
    return {
            offset: inputLength,
            insertedText: "",
            replacedTextLength: 1
          };
  } else {
    return ;
  }
}

function update2(self, input) {
  var change = deviseChange(self, input);
  if (change !== undefined) {
    var match = Buffer$AgdaModeVscode.update(self.buffer, self.textBeforeActivation.length, change);
    var shouldRewrite = match[1];
    var buffer = match[0];
    if (buffer.translation.further) {
      self.buffer = buffer;
      return [
              {
                TAG: 1,
                _0: [[
                    [
                      0,
                      0
                    ],
                    self.textBeforeActivation + Buffer$AgdaModeVscode.toSurface(buffer)
                  ]],
                _1: (function (param) {
                    
                  }),
                [Symbol.for("name")]: "Rewrite"
              },
              {
                TAG: 0,
                _0: Buffer$AgdaModeVscode.toSequence(buffer),
                _1: buffer.translation,
                _2: buffer.candidateIndex,
                [Symbol.for("name")]: "UpdateView"
              }
            ];
    } else {
      self.buffer = Buffer$AgdaModeVscode.make(undefined);
      self.activated = false;
      if (shouldRewrite !== undefined) {
        return [
                {
                  TAG: 1,
                  _0: [[
                      [
                        0,
                        0
                      ],
                      self.textBeforeActivation + shouldRewrite
                    ]],
                  _1: (function (param) {
                      
                    }),
                  [Symbol.for("name")]: "Rewrite"
                },
                /* Deactivate */1
              ];
      } else {
        return [
                {
                  TAG: 1,
                  _0: [[
                      [
                        0,
                        0
                      ],
                      input
                    ]],
                  _1: (function (param) {
                      
                    }),
                  [Symbol.for("name")]: "Rewrite"
                },
                /* Deactivate */1
              ];
      }
    }
  }
  deactivate(self);
  return [/* Deactivate */1];
}

function insertChar2(self, $$char) {
  return update2(self, self.textBeforeActivation + (Buffer$AgdaModeVscode.toSurface(self.buffer) + $$char));
}

function chooseSymbol(self, symbol) {
  var match = self.buffer.symbol;
  if (match === undefined) {
    return [];
  }
  var init = self.buffer;
  self.buffer = {
    symbol: [
      symbol,
      match[1]
    ],
    tail: init.tail,
    translation: init.translation,
    candidateIndex: init.candidateIndex
  };
  return [{
            TAG: 1,
            _0: [[
                [
                  0,
                  0
                ],
                symbol
              ]],
            _1: (function (param) {
                
              }),
            [Symbol.for("name")]: "Rewrite"
          }];
}

var Module = {
  make: make,
  activate: activate,
  deactivate: deactivate,
  isActivated: isActivated,
  update2: update2,
  insertChar2: insertChar2,
  chooseSymbol: chooseSymbol
};

exports.Module = Module;
exports.make = make;
exports.activate = activate;
exports.deactivate = deactivate;
exports.isActivated = isActivated;
exports.update2 = update2;
exports.insertChar2 = insertChar2;
exports.chooseSymbol = chooseSymbol;
/* Buffer-AgdaModeVscode Not a pure module */
