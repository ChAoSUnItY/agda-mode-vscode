// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var $$Promise = require("reason-promise/lib/js/src/js/promise.js");
var Belt_List = require("bs-platform/lib/js/belt_List.js");

function empty(self) {
  var queue = self.queue;
  self.queue = [];
  return queue;
}

function make(param) {
  var match = $$Promise.pending(undefined);
  return {
          queue: [],
          status: /* Idle */1,
          execute: undefined,
          terminationPromise: match[0],
          terminate: match[1],
          shouldTerminate: false
        };
}

function setup(self, execute) {
  self.execute = execute;
  
}

function run(self) {
  var match = self.status;
  if (match) {
    var task = self.queue.shift();
    if (task !== undefined) {
      self.status = /* Busy */0;
      var execute = self.execute;
      if (execute !== undefined) {
        $$Promise.get(Curry._1(execute, task), (function (param) {
                self.status = /* Idle */1;
                return run(self);
              }));
      } else {
        self.status = /* Idle */1;
        run(self);
      }
    }
    
  }
  if (self.shouldTerminate) {
    return Curry._1(self.terminate, undefined);
  }
  
}

function pushAndRun(self, xs) {
  self.queue = Belt_List.toArray(xs).concat(self.queue);
  return run(self);
}

function terminate(self) {
  var match = self.status;
  if (match) {
    return Curry._1(self.terminate, undefined);
  } else {
    self.shouldTerminate = true;
    return ;
  }
}

exports.empty = empty;
exports.make = make;
exports.setup = setup;
exports.run = run;
exports.pushAndRun = pushAndRun;
exports.terminate = terminate;
/* Promise Not a pure module */
